{"version":3,"file":"confirm-order.js","sources":["pages/confirm-order/confirm-order.vue","E:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvY29uZmlybS1vcmRlci9jb25maXJtLW9yZGVyLnZ1ZQ"],"sourcesContent":["<template>\n\t<view class=\"page\">\n\t\t<view class=\"container\">\n\t\t\t<!-- 收货地址 -->\n\t\t\t<view class=\"address-section\">\n\t\t\t\t<view class=\"section-title\">\n\t\t\t\t\t<text>收货地址</text>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 已选择地址 -->\n\t\t\t\t<view class=\"selected-address\" v-if=\"selectedAddress\" @click=\"handleSelectAddress\">\n\t\t\t\t\t<view class=\"address-content\">\n\t\t\t\t\t\t<view class=\"address-header\">\n\t\t\t\t\t\t\t<text class=\"receiver-name\">{{ selectedAddress.receiverName }}</text>\n\t\t\t\t\t\t\t<text class=\"receiver-phone\">{{ selectedAddress.phone }}</text>\n\t\t\t\t\t\t</view>\n\t\t\t\t\t\t<text class=\"address-detail\">{{ selectedAddress.fullAddress }}</text>\n\t\t\t\t\t</view>\n\t\t\t\t\t<text class=\"arrow\">›</text>\n\t\t\t\t</view>\n\t\t\t\t\n\t\t\t\t<!-- 未选择地址 -->\n\t\t\t\t<view class=\"no-address\" v-else @click=\"handleSelectAddress\">\n\t\t\t\t\t<text class=\"no-address-text\">请选择收货地址</text>\n\t\t\t\t\t<text class=\"arrow\">›</text>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t<!-- 商品信息 -->\n\t\t<view class=\"product-section\">\n\t\t\t<view class=\"section-title\">\n\t\t\t\t<text>商品信息</text>\n\t\t\t</view>\n\t\t<view class=\"product-item\">\n\t\t\t<image class=\"product-img\" :src=\"product.imageUrl || '/static/images/logo.png'\" mode=\"widthFix\"></image>\n\t\t\t<view class=\"product-info\">\n\t\t\t\t<view class=\"product-name\">{{ product.name }}</view>\n\t\t\t\t<view class=\"product-price\">¥{{ product.price }}</view>\n\t\t\t</view>\n\t\t\t<view class=\"product-quantity\">\n\t\t\t\t<text>x {{ quantity }}</text>\n\t\t\t</view>\n\t\t</view>\n\t\t</view>\n\t\t</view>\n\t\t\n\t<!-- 底部按钮 -->\n\t<view class=\"bottom-bar\">\n\t\t<view class=\"price-info\">\n\t\t\t<text class=\"price-label\">应缴金额</text>\n\t\t\t<text class=\"price-amount\">¥{{ totalPrice }}</text>\n\t\t</view>\n\t\t<button class=\"pay-button\" @click=\"handlePay\" :loading=\"paying\" :disabled=\"paying\" hover-class=\"button-hover\">立即购买</button>\n\t</view>\n\t</view>\n</template>\n\n<script>\nimport { getProductDetail } from '../../api/product.js';\nimport { createOrder } from '../../api/order.js';\nimport { getMyAddresses } from '../../api/address.js';\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tproductId: null,\n\t\t\tproduct: {},\n\t\t\tquantity: 1,\n\t\t\tselectedAddress: null,\n\t\t\tpaying: false\n\t\t}\n\t},\n\tcomputed: {\n\t\ttotalPrice() {\n\t\t\treturn (this.product.price * this.quantity).toFixed(2);\n\t\t},\n\t\tneedAddress() {\n\t\t\t// 实物商品和组合商品需要地址\n\t\t\treturn this.product.type === 4 || this.product.type === 5;\n\t\t}\n\t},\n\tonLoad(options) {\n\t\tif (options.productId) {\n\t\t\tthis.productId = options.productId;\n\t\t\tthis.loadProductDetail();\n\t\t}\n\t\tif (options.quantity) {\n\t\t\tthis.quantity = parseInt(options.quantity) || 1;\n\t\t}\n\t\t// 加载默认地址\n\t\tthis.loadDefaultAddress();\n\t},\n\tonShow() {\n\t\t// 页面显示时重新查询默认地址\n\t\t// 这样从地址管理页面返回时会刷新地址\n\t\tif (this.needAddress) {\n\t\t\tthis.loadDefaultAddress();\n\t\t}\n\t},\n\tmethods: {\n\t\t// 加载商品详情\n\t\tasync loadProductDetail() {\n\t\t\ttry {\n\t\t\t\tuni.showLoading({ title: '加载中...', mask: true });\n\t\t\t\tconst result = await getProductDetail(this.productId);\n\t\t\t\tthis.product = result || {};\n\t\t\t\tuni.hideLoading();\n\t\t\t} catch (error) {\n\t\t\t\tuni.hideLoading();\n\t\t\t\tconsole.error('加载商品详情失败:', error);\n\t\t\t\tuni.showToast({ title: '加载失败', icon: 'none' });\n\t\t\t}\n\t\t},\n\t\t\n\t\t// 加载默认地址\n\t\tasync loadDefaultAddress() {\n\t\t\ttry {\n\t\t\t\tconst addresses = await getMyAddresses();\n\t\t\t\tif (addresses && addresses.length > 0) {\n\t\t\t\t\t// 查找默认地址\n\t\t\t\t\tconst defaultAddress = addresses.find(addr => addr.isDefault);\n\t\t\t\t\t// 如果有默认地址就使用默认地址，否则使用第一个地址\n\t\t\t\t\tthis.selectedAddress = defaultAddress || addresses[0];\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error('加载地址失败:', error);\n\t\t\t}\n\t\t},\n\t\t\n\t\t// 选择地址\n\t\thandleSelectAddress() {\n\t\t\tuni.navigateTo({\n\t\t\t\turl: '/pages/address-list/address-list?select=true'\n\t\t\t});\n\t\t},\n\t\t\n\t\t// 处理购买（创建订单）\n\t\tasync handlePay() {\n\t\t\t// 实物商品和组合商品必须选择地址\n\t\t\tif (this.needAddress && !this.selectedAddress) {\n\t\t\t\tuni.showModal({\n\t\t\t\t\ttitle: '提示',\n\t\t\t\t\tcontent: '请先选择收货地址',\n\t\t\t\t\tconfirmText: '去选择',\n\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\tif (res.confirm) {\n\t\t\t\t\t\t\tthis.handleSelectAddress();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t\t\n\t\t\tif (this.paying) return;\n\t\t\tthis.paying = true;\n\t\t\t\n\t\t\ttry {\n\t\t\t\tuni.showLoading({ title: '创建订单...', mask: true });\n\t\t\t\t\n\t\t\t\t// 构建订单数据\n\t\t\t\tconst orderData = {\n\t\t\t\t\tproductId: this.productId,\n\t\t\t\t\tquantity: this.quantity\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\t// 如果是实物商品或组合商品，添加地址ID\n\t\t\t\tif (this.needAddress && this.selectedAddress) {\n\t\t\t\t\torderData.addressId = this.selectedAddress.id;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst orderId = await createOrder(orderData);\n\t\t\t\t\n\t\t\t\tuni.hideLoading();\n\t\t\t\t\n\t\t\t\t// 跳转到支付详情页\n\t\t\t\tuni.redirectTo({\n\t\t\t\t\turl: `/pages/payment/payment?orderId=${orderId}&orderNo=${encodeURIComponent('待获取')}&productName=${encodeURIComponent(this.product.name)}&quantity=${this.quantity}&payAmount=${this.totalPrice}&addressId=${this.selectedAddress?.id || ''}`\n\t\t\t\t});\n\t\t\t\t\n\t\t\t} catch (error) {\n\t\t\t\tuni.hideLoading();\n\t\t\t\tconsole.error('创建订单失败:', error);\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: error.message || '创建订单失败',\n\t\t\t\t\ticon: 'none'\n\t\t\t\t});\n\t\t\t} finally {\n\t\t\t\tthis.paying = false;\n\t\t\t}\n\t\t}\n\t}\n}\n</script>\n\n<style scoped lang=\"scss\">\n.page {\n\tmin-height: 100vh;\n\tbackground-color: #f5f5f5;\n\tpadding-bottom: 200rpx;\n}\n\n.container {\n\tpadding: 20rpx 0;\n}\n\n.section-title {\n\tdisplay: flex;\n\talign-items: center;\n\tfont-size: 35rpx;\n\tfont-weight: bold;\n\tcolor: #333333;\n\tpadding: 20rpx 30rpx;\n\tbackground-color: #ffffff;\n\tborder-bottom: 1rpx solid #f0f0f0;\n}\n\n.title-icon {\n\tfont-size: 28rpx;\n\tmargin-right: 8rpx;\n}\n\n/* 收货地址 */\n.address-section {\n\tbackground-color: #ffffff;\n\tmargin-bottom: 20rpx;\n\tbox-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);\n}\n\n.selected-address {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tpadding: 30rpx;\n}\n\n.address-content {\n\tflex: 1;\n\tmargin-right: 20rpx;\n}\n\n.address-header {\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 20rpx;\n\tmargin-bottom: 12rpx;\n}\n\n.receiver-name {\n\tfont-size: 30rpx;\n\tfont-weight: bold;\n\tcolor: #333333;\n}\n\n.receiver-phone {\n\tfont-size: 26rpx;\n\tcolor: #666666;\n}\n\n.address-detail {\n\tfont-size: 26rpx;\n\tcolor: #666666;\n\tline-height: 1.6;\n}\n\n.arrow {\n\tfont-size: 40rpx;\n\tcolor: #cccccc;\n}\n\n.no-address {\n\tdisplay: flex;\n\tjustify-content: space-between;\n\talign-items: center;\n\tpadding: 40rpx 30rpx;\n\tbackground: linear-gradient(135deg, #fff9e6 0%, #ffffff 100%);\n\tborder: 2rpx dashed #f5a623;\n\tmargin: 20rpx;\n\tborder-radius: 12rpx;\n}\n\n.no-address-icon {\n\tfont-size: 40rpx;\n\tmargin-right: 12rpx;\n}\n\n.no-address-text {\n\tflex: 1;\n\tfont-size: 28rpx;\n\tcolor: #f5a623;\n\tfont-weight: 500;\n}\n\n/* 商品信息 */\n.product-section {\n\tbackground-color: #ffffff;\n\tmargin-bottom: 20rpx;\n\tbox-shadow: 0 2rpx 8rpx rgba(0, 0, 0, 0.05);\n}\n\n.product-item {\n\tdisplay: flex;\n\talign-items: center;\n\tpadding: 30rpx;\n\tmin-height: 180rpx;\n}\n\n.product-img {\n\twidth: 150rpx;\n\theight: auto;\n\tmax-height: 200rpx;\n\tborder-radius: 12rpx;\n\tmargin-right: 20rpx;\n\tbackground-color: #f5f5f5;\n\tflex-shrink: 0;\n\tdisplay: block;\n}\n\n.product-info {\n\tflex: 1;\n\tdisplay: flex;\n\tflex-direction: column;\n\tjustify-content: space-between;\n\tmin-height: 150rpx;\n}\n\n.product-name {\n\tfont-size: 28rpx;\n\tcolor: #333333;\n\tfont-weight: 500;\n\tmargin-bottom: 16rpx;\n\tline-height: 1.5;\n}\n\n.product-price {\n\tfont-size: 32rpx;\n\tfont-weight: bold;\n\tcolor: #90d26c;\n}\n\n.product-quantity {\n\tfont-size: 28rpx;\n\tcolor: #666666;\n\tflex-shrink: 0;\n\tmargin-left: 20rpx;\n}\n\n/* 底部按钮 */\n.bottom-bar {\n\tposition: fixed;\n\tbottom: 0;\n\tleft: 0;\n\tright: 0;\n\tbackground-color: #ffffff;\n\tpadding: 20rpx 30rpx 30rpx;\n\tbox-shadow: 0 -2rpx 10rpx rgba(0, 0, 0, 0.05);\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: stretch;\n\tz-index: 100;\n}\n\n.price-info {\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: flex-end;\n\tmargin-bottom: 16rpx;\n}\n\n.price-label {\n\tfont-size: 24rpx;\n\tcolor: #333333;\n\tmargin-bottom: 4rpx;\n}\n\n.price-amount {\n\tfont-size: 40rpx;\n\tfont-weight: bold;\n\tcolor: #297512;\n}\n\n.pay-button {\n\twidth: 100%;\n\theight: 88rpx;\n\tbackground: linear-gradient(135deg, #2b4509 0%, #1e4a13 100%);\n\tborder-radius: 44rpx;\n\tfont-size: 32rpx;\n\tfont-weight: bold;\n\tcolor: #ffffff;\n\tborder: none;\n\tline-height: 88rpx;\n\tpadding: 0;\n}\n\n.pay-button[disabled] {\n\topacity: 0.6;\n}\n\n.pay-button::after {\n\tborder: none;\n}\n\n.button-hover {\n\topacity: 0.85;\n}\n</style>\n","import MiniProgramPage from 'D:/AAA_idea_java/pandaBase/panda-base-uni-app/pages/confirm-order/confirm-order.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","getProductDetail","getMyAddresses","createOrder"],"mappings":";;;;;AA8DA,MAAK,YAAU;AAAA,EACd,OAAO;AACN,WAAO;AAAA,MACN,WAAW;AAAA,MACX,SAAS,CAAE;AAAA,MACX,UAAU;AAAA,MACV,iBAAiB;AAAA,MACjB,QAAQ;AAAA,IACT;AAAA,EACA;AAAA,EACD,UAAU;AAAA,IACT,aAAa;AACZ,cAAQ,KAAK,QAAQ,QAAQ,KAAK,UAAU,QAAQ,CAAC;AAAA,IACrD;AAAA,IACD,cAAc;AAEb,aAAO,KAAK,QAAQ,SAAS,KAAK,KAAK,QAAQ,SAAS;AAAA,IACzD;AAAA,EACA;AAAA,EACD,OAAO,SAAS;AACf,QAAI,QAAQ,WAAW;AACtB,WAAK,YAAY,QAAQ;AACzB,WAAK,kBAAiB;AAAA,IACvB;AACA,QAAI,QAAQ,UAAU;AACrB,WAAK,WAAW,SAAS,QAAQ,QAAQ,KAAK;AAAA,IAC/C;AAEA,SAAK,mBAAkB;AAAA,EACvB;AAAA,EACD,SAAS;AAGR,QAAI,KAAK,aAAa;AACrB,WAAK,mBAAkB;AAAA,IACxB;AAAA,EACA;AAAA,EACD,SAAS;AAAA;AAAA,IAER,MAAM,oBAAoB;AACzB,UAAI;AACHA,sBAAG,MAAC,YAAY,EAAE,OAAO,UAAU,MAAM,KAAG,CAAG;AAC/C,cAAM,SAAS,MAAMC,YAAAA,iBAAiB,KAAK,SAAS;AACpD,aAAK,UAAU,UAAU;AACzBD,sBAAG,MAAC,YAAW;AAAA,MACd,SAAO,OAAO;AACfA,sBAAG,MAAC,YAAW;AACfA,sBAAA,MAAA,MAAA,SAAA,gDAAc,aAAa,KAAK;AAChCA,sBAAG,MAAC,UAAU,EAAE,OAAO,QAAQ,MAAM,OAAK,CAAG;AAAA,MAC9C;AAAA,IACA;AAAA;AAAA,IAGD,MAAM,qBAAqB;AAC1B,UAAI;AACH,cAAM,YAAY,MAAME,YAAAA;AACxB,YAAI,aAAa,UAAU,SAAS,GAAG;AAEtC,gBAAM,iBAAiB,UAAU,KAAK,UAAQ,KAAK,SAAS;AAE5D,eAAK,kBAAkB,kBAAkB,UAAU,CAAC;AAAA,QACrD;AAAA,MACC,SAAO,OAAO;AACfF,sBAAA,MAAA,MAAA,SAAA,gDAAc,WAAW,KAAK;AAAA,MAC/B;AAAA,IACA;AAAA;AAAA,IAGD,sBAAsB;AACrBA,oBAAAA,MAAI,WAAW;AAAA,QACd,KAAK;AAAA,MACN,CAAC;AAAA,IACD;AAAA;AAAA,IAGD,MAAM,YAAY;;AAEjB,UAAI,KAAK,eAAe,CAAC,KAAK,iBAAiB;AAC9CA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO;AAAA,UACP,SAAS;AAAA,UACT,aAAa;AAAA,UACb,SAAS,CAAC,QAAQ;AACjB,gBAAI,IAAI,SAAS;AAChB,mBAAK,oBAAmB;AAAA,YACzB;AAAA,UACD;AAAA,QACD,CAAC;AACD;AAAA,MACD;AAEA,UAAI,KAAK;AAAQ;AACjB,WAAK,SAAS;AAEd,UAAI;AACHA,sBAAG,MAAC,YAAY,EAAE,OAAO,WAAW,MAAM,KAAG,CAAG;AAGhD,cAAM,YAAY;AAAA,UACjB,WAAW,KAAK;AAAA,UAChB,UAAU,KAAK;AAAA;AAIhB,YAAI,KAAK,eAAe,KAAK,iBAAiB;AAC7C,oBAAU,YAAY,KAAK,gBAAgB;AAAA,QAC5C;AAEA,cAAM,UAAU,MAAMG,sBAAY,SAAS;AAE3CH,sBAAG,MAAC,YAAW;AAGfA,sBAAAA,MAAI,WAAW;AAAA,UACd,KAAK,kCAAkC,OAAO,YAAY,mBAAmB,KAAK,CAAC,gBAAgB,mBAAmB,KAAK,QAAQ,IAAI,CAAC,aAAa,KAAK,QAAQ,cAAc,KAAK,UAAU,gBAAc,UAAK,oBAAL,mBAAsB,OAAM,EAAE;AAAA,QAC5O,CAAC;AAAA,MAEA,SAAO,OAAO;AACfA,sBAAG,MAAC,YAAW;AACfA,sBAAA,MAAA,MAAA,SAAA,gDAAc,WAAW,KAAK;AAC9BA,sBAAAA,MAAI,UAAU;AAAA,UACb,OAAO,MAAM,WAAW;AAAA,UACxB,MAAM;AAAA,QACP,CAAC;AAAA,MACF,UAAU;AACT,aAAK,SAAS;AAAA,MACf;AAAA,IACD;AAAA,EACD;AACD;;;;;;;;;;;;;;;;;;;;;;;AC9LA,GAAG,WAAW,eAAe;"}