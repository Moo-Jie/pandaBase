{"version":3,"file":"login.js","sources":["pages/login/login.vue","E:/HBuilderX.4.76.2025082103/HBuilderX/plugins/uniapp-cli-vite/uniPage:/cGFnZXMvbG9naW4vbG9naW4udnVl"],"sourcesContent":["<template>\n\t<view class=\"page\">\n\t\t<!-- ËÉåÊôØË£ÖÈ•∞ -->\n\t\t<view class=\"bg-decoration\">\n\t\t\t<view class=\"bamboo-left\">üéã</view>\n\t\t\t<view class=\"bamboo-right\">üéã</view>\n\t\t</view>\n\t\t\n\t\t<view class=\"container\">\n\t\t\t<!-- Logo -->\n\t\t\t<view class=\"logo-section\">\n\t\t\t\t<view class=\"panda-icon\">üêº</view>\n\t\t\t\t<text class=\"app-name\">ÁÜäÁå´Âü∫Âú∞</text>\n\t\t\t\t<text class=\"app-slogan\">Ê¨¢ËøéËøõÂÖ•ÁÜäÁå´ÁöÑ‰∏ñÁïå</text>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- Áî®Êà∑‰ø°ÊÅØÂç°Áâá -->\n\t\t\t<view class=\"user-info-card\">\n\t\t\t\t<!-- Â§¥ÂÉè -->\n\t\t\t\t<button \n\t\t\t\t\tclass=\"avatar-button\" \n\t\t\t\t\topen-type=\"chooseAvatar\" \n\t\t\t\t\t@chooseavatar=\"onChooseAvatar\"\n\t\t\t\t\thover-class=\"none\"\n\t\t\t\t>\n\t\t\t\t\t<image \n\t\t\t\t\t\tclass=\"avatar\" \n\t\t\t\t\t\t:src=\"tempAvatarUrl || defaultAvatar\" \n\t\t\t\t\t\tmode=\"aspectFill\"\n\t\t\t\t\t></image>\n\t\t\t\t\t<view class=\"avatar-tip\">{{ avatarUrl ? 'Â∑≤‰∏ä‰º†' : 'ÁÇπÂáªÈÄâÊã©Â§¥ÂÉè' }}</view>\n\t\t\t\t</button>\n\t\t\t\t\n\t\t\t\t<!-- ÊòµÁß∞ËæìÂÖ• -->\n\t\t\t\t<view class=\"nickname-section\">\n\t\t\t\t\t<text class=\"nickname-label\">ËÆæÁΩÆÊòµÁß∞</text>\n\t\t\t\t\t<input \n\t\t\t\t\t\tclass=\"nickname-input\" \n\t\t\t\t\t\ttype=\"nickname\"\n\t\t\t\t\t\tv-model=\"nickname\"\n\t\t\t\t\t\tplaceholder=\"ËØ∑ËæìÂÖ•ÊòµÁß∞\"\n\t\t\t\t\t\tplaceholder-class=\"placeholder\"\n\t\t\t\t\t\tmaxlength=\"20\"\n\t\t\t\t\t/>\n\t\t\t\t</view>\n\t\t\t</view>\n\t\t\t\n\t\t\t<!-- ÁôªÂΩïÊåâÈíÆ -->\n\t\t\t<button \n\t\t\t\tclass=\"wx-login-btn\" \n\t\t\t\t@click=\"handleWxLogin\" \n\t\t\t\t:loading=\"loading\" \n\t\t\t\t:disabled=\"loading\"\n\t\t\t\thover-class=\"button-hover\"\n\t\t\t>\n\t\t\t\t<text class=\"wx-icon\">üí¨</text>\n\t\t\t\t<text class=\"btn-text\">ÂæÆ‰ø°ÊéàÊùÉÁôªÂΩï</text>\n\t\t\t</button>\n\t\t\t\n\t\t\t<!-- ÊèêÁ§∫ÊñáÂ≠ó -->\n\t\t\t<view class=\"tip-section\">\n\t\t\t\t<text class=\"tip-text\">ÁôªÂΩïÂç≥Ë°®Á§∫ÂêåÊÑè„ÄäÁî®Êà∑ÂçèËÆÆ„ÄãÂíå„ÄäÈöêÁßÅÊîøÁ≠ñ„Äã</text>\n\t\t\t</view>\n\t\t</view>\n\t</view>\n</template>\n\n<script>\nimport { wxLogin, uploadAvatar } from '../../api/user.js';\nimport { setUserInfo } from '../../utils/auth.js';\nimport { showError } from '../../utils/message.js';\n\nexport default {\n\tdata() {\n\t\treturn {\n\t\t\tloading: false,\n\t\t\tredirect: '', // ÁôªÂΩïÂêéË∑≥ËΩ¨ÁöÑÈ°µÈù¢\n\t\t\tavatarUrl: '', // Áî®Êà∑Â§¥ÂÉèURLÔºàOSS URLÔºâ\n\t\t\ttempAvatarUrl: '', // ‰∏¥Êó∂Â§¥ÂÉèURLÔºàÁî®‰∫éÊòæÁ§∫Ôºâ\n\t\t\tnickname: '', // Áî®Êà∑ÊòµÁß∞\n\t\t\tdefaultAvatar: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48Y2lyY2xlIGN4PSI1MCIgY3k9IjUwIiByPSI1MCIgZmlsbD0iI2YwZjBmMCIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjQwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSIgZmlsbD0iIzk5OSI+8J+QvDwvdGV4dD48L3N2Zz4=' // ÈªòËÆ§Â§¥ÂÉè\n\t\t}\n\t},\n\tonLoad(options) {\n\t\tif (options.redirect) {\n\t\t\tthis.redirect = decodeURIComponent(options.redirect);\n\t\t}\n\t},\n\tmethods: {\n\t\t// ÈÄâÊã©Â§¥ÂÉèÂõûË∞É\n\t\tasync onChooseAvatar(e) {\n\t\t\tconsole.log('chooseAvatar:', e);\n\t\t\tif (e.detail.avatarUrl) {\n\t\t\t\tconst tempPath = e.detail.avatarUrl;\n\t\t\t\tthis.tempAvatarUrl = tempPath; // ÂÖàÊòæÁ§∫‰∏¥Êó∂Â§¥ÂÉè\n\t\t\t\t\n\t\t\t\ttry {\n\t\t\t\t\tuni.showLoading({\n\t\t\t\t\t\ttitle: '‰∏ä‰º†Â§¥ÂÉè‰∏≠...',\n\t\t\t\t\t\tmask: true\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t// ‰∏ä‰º†Âà∞OSS\n\t\t\t\t\tconst ossUrl = await uploadAvatar(tempPath);\n\t\t\t\t\tthis.avatarUrl = ossUrl; // ‰øùÂ≠òOSS URL\n\t\t\t\t\t\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\tuni.showToast({\n\t\t\t\t\t\ttitle: 'Â§¥ÂÉè‰∏ä‰º†ÊàêÂäü',\n\t\t\t\t\t\ticon: 'success',\n\t\t\t\t\t\tduration: 1000\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tconsole.log('Â§¥ÂÉè‰∏ä‰º†ÊàêÂäüÔºåOSS URL:', ossUrl);\n\t\t\t\t} catch (error) {\n\t\t\t\t\tuni.hideLoading();\n\t\t\t\t\tconsole.error('Â§¥ÂÉè‰∏ä‰º†Â§±Ë¥•:', error);\n\t\t\t\t\tshowError('Â§¥ÂÉè‰∏ä‰º†Â§±Ë¥•ÔºåËØ∑ÈáçËØï');\n\t\t\t\t\t// Ê∏ÖÁ©∫Â§¥ÂÉè\n\t\t\t\t\tthis.tempAvatarUrl = '';\n\t\t\t\t\tthis.avatarUrl = '';\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Â§ÑÁêÜÂæÆ‰ø°ÁôªÂΩï\n\t\tasync handleWxLogin() {\n\t\t\tif (this.loading) return;\n\t\t\tthis.loading = true;\n\t\t\t\n\t\t\ttry {\n\t\t\t\tuni.showLoading({\n\t\t\t\t\ttitle: 'ÁôªÂΩï‰∏≠...',\n\t\t\t\t\tmask: true\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// 1. Ë∞ÉÁî®wx.loginËé∑Âèñcode\n\t\t\t\tconst loginRes = await new Promise((resolve, reject) => {\n\t\t\t\t\tuni.login({\n\t\t\t\t\t\tprovider: 'weixin',\n\t\t\t\t\t\tsuccess: (res) => {\n\t\t\t\t\t\t\tconsole.log('uni.login success:', res);\n\t\t\t\t\t\t\tresolve(res);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tfail: (err) => {\n\t\t\t\t\t\t\tconsole.error('uni.login fail:', err);\n\t\t\t\t\t\t\treject(err);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif (!loginRes || !loginRes.code) {\n\t\t\t\t\tthrow new Error('Ëé∑ÂèñÁôªÂΩïÂá≠ËØÅÂ§±Ë¥•');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tconst code = loginRes.code;\n\t\t\t\tconsole.log('Ëé∑ÂèñÂà∞ÂæÆ‰ø°ÁôªÂΩïcode:', code);\n\t\t\t\t\n\t\t\t\t// 2. ÂáÜÂ§áÁôªÂΩïÊï∞ÊçÆ\n\t\t\t\tconst loginData = {\n\t\t\t\t\tcode: code,\n\t\t\t\t\tnickname: this.nickname || '', // Áî®Êà∑ËæìÂÖ•ÁöÑÊòµÁß∞ÔºàÂèØËÉΩ‰∏∫Á©∫Ôºâ\n\t\t\t\t\tavatarUrl: this.avatarUrl || '' // Áî®Êà∑ÈÄâÊã©ÁöÑÂ§¥ÂÉèÔºàÂèØËÉΩ‰∏∫Á©∫Ôºâ\n\t\t\t\t};\n\t\t\t\t\n\t\t\t\tconsole.log('ÁôªÂΩïÊï∞ÊçÆ:', loginData);\n\t\t\t\t\n\t\t\t\t// 3. Ë∞ÉÁî®ÂêéÁ´ØÊé•Âè£Ôºå‰ΩøÁî®codeÊç¢ÂèñÁî®Êà∑‰ø°ÊÅØ\n\t\t\t\tconst result = await wxLogin(loginData);\n\t\t\t\t\n\t\t\t\t// 4. ‰øùÂ≠òÁî®Êà∑‰ø°ÊÅØÂà∞Êú¨Âú∞\n\t\t\t\tsetUserInfo(result);\n\t\t\t\t\n\t\t\t\tuni.hideLoading();\n\t\t\t\tuni.showToast({\n\t\t\t\t\ttitle: 'ÁôªÂΩïÊàêÂäü',\n\t\t\t\t\ticon: 'success',\n\t\t\t\t\tduration: 1500\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\t// 5. Ë∑≥ËΩ¨È°µÈù¢\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tif (this.redirect) {\n\t\t\t\t\t\tuni.redirectTo({\n\t\t\t\t\t\t\turl: this.redirect\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tuni.switchTab({\n\t\t\t\t\t\t\turl: '/pages/index/index'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}, 1500);\n\t\t\t\t\n\t\t\t} catch (error) {\n\t\t\t\tuni.hideLoading();\n\t\t\t\tconsole.error('ÂæÆ‰ø°ÁôªÂΩïÂ§±Ë¥•:', error);\n\t\t\t\tshowError(error.message || 'ÁôªÂΩïÂ§±Ë¥•ÔºåËØ∑ÈáçËØï');\n\t\t\t} finally {\n\t\t\t\tthis.loading = false;\n\t\t\t}\n\t\t}\n\t}\n}\n</script>\n\n<style scoped lang=\"scss\">\n.page {\n\tmin-height: 100vh;\n\tbackground: linear-gradient(180deg, #f0f9f0 0%, #ffffff 100%);\n\tposition: relative;\n\toverflow: hidden;\n}\n\n/* ËÉåÊôØË£ÖÈ•∞ */\n.bg-decoration {\n\tposition: absolute;\n\twidth: 100%;\n\theight: 100%;\n\tpointer-events: none;\n}\n\n.bamboo-left {\n\tposition: absolute;\n\ttop: 20rpx;\n\tleft: -40rpx;\n\tfont-size: 200rpx;\n\topacity: 0.1;\n\ttransform: rotate(-15deg);\n}\n\n.bamboo-right {\n\tposition: absolute;\n\tbottom: 20rpx;\n\tright: -40rpx;\n\tfont-size: 200rpx;\n\topacity: 0.1;\n\ttransform: rotate(15deg);\n}\n\n.container {\n\tposition: relative;\n\tz-index: 1;\n\tpadding: 120rpx 60rpx;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n}\n\n/* LogoÂå∫Âüü */\n.logo-section {\n\ttext-align: center;\n\tmargin-bottom: 120rpx;\n}\n\n.panda-icon {\n\tfont-size: 180rpx;\n\tmargin-bottom: 30rpx;\n\tanimation: float 3s ease-in-out infinite;\n}\n\n@keyframes float {\n\t0%, 100% {\n\t\ttransform: translateY(0);\n\t}\n\t50% {\n\t\ttransform: translateY(-20rpx);\n\t}\n}\n\n.app-name {\n\tdisplay: block;\n\tfont-size: 56rpx;\n\tfont-weight: bold;\n\tcolor: #333333;\n\tmargin-bottom: 16rpx;\n}\n\n.app-slogan {\n\tdisplay: block;\n\tfont-size: 28rpx;\n\tcolor: #666666;\n}\n\n/* Áî®Êà∑‰ø°ÊÅØÂç°Áâá */\n.user-info-card {\n\tbackground: #ffffff;\n\tborder-radius: 32rpx;\n\tpadding: 60rpx 40rpx;\n\tmargin-bottom: 60rpx;\n\tbox-shadow: 0 8rpx 32rpx rgba(0, 0, 0, 0.08);\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n}\n\n.avatar-button {\n\tbackground: none;\n\tborder: none;\n\tpadding: 0;\n\tmargin: 0;\n\tdisplay: flex;\n\tflex-direction: column;\n\talign-items: center;\n\tmargin-bottom: 40rpx;\n}\n\n.avatar-button::after {\n\tborder: none;\n}\n\n.avatar {\n\twidth: 160rpx;\n\theight: 160rpx;\n\tborder-radius: 80rpx;\n\tborder: 6rpx solid #f0f0f0;\n\tmargin-bottom: 16rpx;\n}\n\n.avatar-tip {\n\tfont-size: 24rpx;\n\tcolor: #999999;\n}\n\n.nickname-section {\n\twidth: 100%;\n}\n\n.nickname-label {\n\tdisplay: block;\n\tfont-size: 28rpx;\n\tcolor: #333333;\n\tfont-weight: 500;\n\tmargin-bottom: 16rpx;\n}\n\n.nickname-input {\n\twidth: 80%;\n\theight: 88rpx;\n\tbackground-color: #f5f5f5;\n\tborder-radius: 16rpx;\n\tpadding: 0 30rpx;\n\tfont-size: 28rpx;\n\tcolor: #333333;\n\tborder: 2rpx solid #f0f0f0;\n}\n\n.placeholder {\n\tcolor: #999999;\n}\n\n/* ÂæÆ‰ø°ÁôªÂΩïÊåâÈíÆ */\n.wx-login-btn {\n\twidth: 600rpx;\n\theight: 96rpx;\n\tbackground: linear-gradient(135deg, #07c160 0%, #06ae56 100%);\n\tborder-radius: 48rpx;\n\tdisplay: flex;\n\talign-items: center;\n\tjustify-content: center;\n\tfont-size: 32rpx;\n\tfont-weight: bold;\n\tcolor: #ffffff;\n\tborder: none;\n\tbox-shadow: 0 8rpx 24rpx rgba(7, 193, 96, 0.3);\n\tmargin-bottom: 24rpx;\n}\n\n.wx-login-btn[disabled] {\n\topacity: 0.6;\n}\n\n.wx-login-btn::after {\n\tborder: none;\n}\n\n\n.wx-icon {\n\tfont-size: 40rpx;\n\tmargin-right: 12rpx;\n}\n\n.btn-text {\n\tfont-size: 32rpx;\n}\n\n.button-hover {\n\topacity: 0.9;\n\ttransform: scale(0.98);\n}\n\n/* ÊèêÁ§∫Âå∫Âüü */\n.tip-section {\n\ttext-align: center;\n\tmargin-top: 80rpx;\n}\n\n.tip-text {\n\tfont-size: 24rpx;\n\tcolor: #999999;\n\tline-height: 1.8;\n}\n</style>\n","import MiniProgramPage from 'D:/AAA_idea_java/pandaBase/panda-base-uni-app/pages/login/login.vue'\nwx.createPage(MiniProgramPage)"],"names":["uni","uploadAvatar","showError","wxLogin","setUserInfo"],"mappings":"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"}