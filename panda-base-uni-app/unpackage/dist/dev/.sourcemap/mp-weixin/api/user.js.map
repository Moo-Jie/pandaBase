{"version":3,"file":"user.js","sources":["api/user.js"],"sourcesContent":["// 用户相关接口\nimport { get, post } from '../utils/request.js';\n\n/**\n * 微信登录\n * @param {Object} data 登录数据 { code }\n */\nexport function wxLogin(data) {\n\treturn post('/user/wx/login', data);\n}\n\n/**\n * 获取当前登录用户信息\n */\nexport function getLoginUser() {\n\treturn get('/user/get/login', {});\n}\n\n/**\n * 用户登出\n */\nexport function logout() {\n\treturn post('/user/logout', {});\n}\n\n/**\n * 上传头像到OSS\n * @param {String} filePath 文件临时路径\n */\nexport function uploadAvatar(filePath) {\n\t// 获取完整的BASE_URL\n\tconst BASE_URL = 'http://169.254.43.148:8101/api';\n\t\n\treturn new Promise((resolve, reject) => {\n\t\tuni.uploadFile({\n\t\t\turl: BASE_URL + '/file/upload-image', // 完整的上传URL\n\t\t\tfilePath: filePath,\n\t\t\tname: 'file',\n\t\t\tsuccess: (res) => {\n\t\t\t\tconsole.log('上传响应:', res);\n\t\t\t\tif (res.statusCode === 200) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tconst data = JSON.parse(res.data);\n\t\t\t\t\t\tconsole.log('解析后的数据:', data);\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (data.code === 0) { // 后端返回code=0表示成功\n\t\t\t\t\t\t\t// 后端返回的是字符串URL（不是FileInfo对象）\n\t\t\t\t\t\t\tconst url = data.data;\n\t\t\t\t\t\t\tconsole.log('获取到的URL:', url);\n\t\t\t\t\t\t\tresolve(url);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treject(new Error(data.message || '上传失败'));\n\t\t\t\t\t\t}\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.error('解析响应失败:', e);\n\t\t\t\t\t\treject(new Error('解析响应失败'));\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treject(new Error('上传失败，状态码：' + res.statusCode));\n\t\t\t\t}\n\t\t\t},\n\t\t\tfail: (err) => {\n\t\t\t\tconsole.error('上传请求失败:', err);\n\t\t\t\treject(err);\n\t\t\t}\n\t\t});\n\t});\n}\n\n"],"names":["post","get","uni"],"mappings":";;;AAOO,SAAS,QAAQ,MAAM;AAC7B,SAAOA,cAAI,KAAC,kBAAkB,IAAI;AACnC;AAKO,SAAS,eAAe;AAC9B,SAAOC,cAAG,IAAC,mBAAmB,CAAA,CAAE;AACjC;AAKO,SAAS,SAAS;AACxB,SAAOD,cAAI,KAAC,gBAAgB,CAAA,CAAE;AAC/B;AAMO,SAAS,aAAa,UAAU;AAEtC,QAAM,WAAW;AAEjB,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCE,kBAAAA,MAAI,WAAW;AAAA,MACd,KAAK,WAAW;AAAA;AAAA,MAChB;AAAA,MACA,MAAM;AAAA,MACN,SAAS,CAAC,QAAQ;AACjBA,sBAAY,MAAA,MAAA,OAAA,qBAAA,SAAS,GAAG;AACxB,YAAI,IAAI,eAAe,KAAK;AAC3B,cAAI;AACH,kBAAM,OAAO,KAAK,MAAM,IAAI,IAAI;AAChCA,0BAAY,MAAA,MAAA,OAAA,qBAAA,WAAW,IAAI;AAE3B,gBAAI,KAAK,SAAS,GAAG;AAEpB,oBAAM,MAAM,KAAK;AACjBA,4BAAA,MAAA,MAAA,OAAA,qBAAY,YAAY,GAAG;AAC3B,sBAAQ,GAAG;AAAA,YAClB,OAAa;AACN,qBAAO,IAAI,MAAM,KAAK,WAAW,MAAM,CAAC;AAAA,YACxC;AAAA,UACD,SAAQ,GAAG;AACXA,0BAAA,MAAA,MAAA,SAAA,qBAAc,WAAW,CAAC;AAC1B,mBAAO,IAAI,MAAM,QAAQ,CAAC;AAAA,UAC1B;AAAA,QACN,OAAW;AACN,iBAAO,IAAI,MAAM,cAAc,IAAI,UAAU,CAAC;AAAA,QAC9C;AAAA,MACD;AAAA,MACD,MAAM,CAAC,QAAQ;AACdA,gEAAc,WAAW,GAAG;AAC5B,eAAO,GAAG;AAAA,MACV;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;;;;;"}