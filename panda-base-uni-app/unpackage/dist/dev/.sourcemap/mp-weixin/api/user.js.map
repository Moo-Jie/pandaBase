{"version":3,"file":"user.js","sources":["api/user.js"],"sourcesContent":["// 用户相关接口\r\nimport { get, post } from '../utils/request.js';\r\n\r\n/**\r\n * 微信登录\r\n * @param {Object} data 登录数据 { code }\r\n */\r\nexport function wxLogin(data) {\r\n\treturn post('/user/wx/login', data);\r\n}\r\n\r\n/**\r\n * 获取当前登录用户信息\r\n */\r\nexport function getLoginUser() {\r\n\treturn get('/user/get/login', {});\r\n}\r\n\r\n/**\r\n * 用户登出\r\n */\r\nexport function logout() {\r\n\treturn post('/user/logout', {});\r\n}\r\n\r\n/**\r\n * 上传头像到OSS\r\n * @param {String} filePath 文件临时路径\r\n */\r\nexport function uploadAvatar(filePath) {\r\n\t// 获取完整的BASE_URL\r\n\tconst BASE_URL = 'http://localhost:8101/api';\r\n\t\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tuni.uploadFile({\r\n\t\t\turl: BASE_URL + '/file/upload-image', // 完整的上传URL\r\n\t\t\tfilePath: filePath,\r\n\t\t\tname: 'file',\r\n\t\t\tsuccess: (res) => {\r\n\t\t\t\tconsole.log('上传响应:', res);\r\n\t\t\t\tif (res.statusCode === 200) {\r\n\t\t\t\t\ttry {\r\n\t\t\t\t\t\tconst data = JSON.parse(res.data);\r\n\t\t\t\t\t\tconsole.log('解析后的数据:', data);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (data.code === 0) { // 后端返回code=0表示成功\r\n\t\t\t\t\t\t\t// 后端返回的是字符串URL（不是FileInfo对象）\r\n\t\t\t\t\t\t\tconst url = data.data;\r\n\t\t\t\t\t\t\tconsole.log('获取到的URL:', url);\r\n\t\t\t\t\t\t\tresolve(url);\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\treject(new Error(data.message || '上传失败'));\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t} catch (e) {\r\n\t\t\t\t\t\tconsole.error('解析响应失败:', e);\r\n\t\t\t\t\t\treject(new Error('解析响应失败'));\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\treject(new Error('上传失败，状态码：' + res.statusCode));\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfail: (err) => {\r\n\t\t\t\tconsole.error('上传请求失败:', err);\r\n\t\t\t\treject(err);\r\n\t\t\t}\r\n\t\t});\r\n\t});\r\n}\r\n\r\n"],"names":["post","get","uni"],"mappings":";;;AAOO,SAAS,QAAQ,MAAM;AAC7B,SAAOA,cAAI,KAAC,kBAAkB,IAAI;AACnC;AAKO,SAAS,eAAe;AAC9B,SAAOC,cAAG,IAAC,mBAAmB,CAAA,CAAE;AACjC;AAKO,SAAS,SAAS;AACxB,SAAOD,cAAI,KAAC,gBAAgB,CAAA,CAAE;AAC/B;AAMO,SAAS,aAAa,UAAU;AAEtC,QAAM,WAAW;AAEjB,SAAO,IAAI,QAAQ,CAAC,SAAS,WAAW;AACvCE,kBAAAA,MAAI,WAAW;AAAA,MACd,KAAK,WAAW;AAAA;AAAA,MAChB;AAAA,MACA,MAAM;AAAA,MACN,SAAS,CAAC,QAAQ;AACjBA,8DAAY,SAAS,GAAG;AACxB,YAAI,IAAI,eAAe,KAAK;AAC3B,cAAI;AACH,kBAAM,OAAO,KAAK,MAAM,IAAI,IAAI;AAChCA,0BAAY,MAAA,MAAA,OAAA,qBAAA,WAAW,IAAI;AAE3B,gBAAI,KAAK,SAAS,GAAG;AAEpB,oBAAM,MAAM,KAAK;AACjBA,4BAAY,MAAA,MAAA,OAAA,qBAAA,YAAY,GAAG;AAC3B,sBAAQ,GAAG;AAAA,YAClB,OAAa;AACN,qBAAO,IAAI,MAAM,KAAK,WAAW,MAAM,CAAC;AAAA,YACxC;AAAA,UACD,SAAQ,GAAG;AACXA,0BAAc,MAAA,MAAA,SAAA,qBAAA,WAAW,CAAC;AAC1B,mBAAO,IAAI,MAAM,QAAQ,CAAC;AAAA,UAC1B;AAAA,QACN,OAAW;AACN,iBAAO,IAAI,MAAM,cAAc,IAAI,UAAU,CAAC;AAAA,QAC9C;AAAA,MACD;AAAA,MACD,MAAM,CAAC,QAAQ;AACdA,sBAAA,MAAA,MAAA,SAAA,qBAAc,WAAW,GAAG;AAC5B,eAAO,GAAG;AAAA,MACV;AAAA,IACJ,CAAG;AAAA,EACH,CAAE;AACF;;;;;"}