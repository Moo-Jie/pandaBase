
# 1. 文档概述

1.1 版本记录

|              |            |                            |
| ------------ | ---------- | -------------------------- |
| 版本           | 更新时间       | 更新详细内容                     |
| V1.0         | 2025/11/19 | 主要功能逻辑                     |
| V1.1（客户会议共识） | 2025/11/22 | 商城细化购买、个人中心增加兑换、去掉卡片展示核销功能 |

1.2 项目背景

背景——

小程序包含 年卡、月卡、次票等虚拟票证购买，以及邮寄周边实物商品。用户可通过小程序进行购买、兑换、查看权益与售后。

渠道形式——

小程序客户端

# 2. 用户场景

#### 2.2 核心使用场景

● 用户购买：年卡/月卡/组合商品

● 用户打开年卡/月卡/次卡并出示会员卡入基地

● 用户兑换：年卡/月卡/组合商品

● 用户查看所有订单信息

● 用户联系客服处理售后/发票/公益证书等问题

# 3. 产品范围

3.1 前端功能：用户可见的

熊猫基地小程序 [熊猫基地小程序](https://docs.qq.com/mind/DYndtRVJwdWd3VnZm)

● 商品组合线上购买：用户查看商品详情 → 确认购买 → 填写地址 → 发货

● 商品组合线上兑换：用户输入卡券码 → 核销 → 填写地址 → 发货

● 订单查询、客服等用户中心功能

3.2 运营支持：用户不可见，基地运营维护需要（待定看业务是否有现成券码）

1、会员卡卡券数据生成、存储与导出；

2、兑换码数据生成、存储与导出；

3、用户购买、兑换数据定期导出（按需/周/月）；

备注：开发提供一年售后服务，支持以上三项按业务要求定期生成&倒出数据

3.3 排除范围：本次不包含的功能（边界说明）

仅开发小程序客户端，不包含管理端（管理订单、会员卡生成等）

实体兑换物品暂不支持接入物流状态，仅业务通过客服方式自行提供给到用户

公益证书暂不支持，仅业务通过客服方式自行提供给到用户

开发票功能暂不支持，仅业务通过客服方式自行提供给到用户

# 4.  全局说明

● 登录/注册：全站操作建议基于微信授权登录。涉及购买，支付、兑换、查看个人信息时，需强制校验登录状态。

调用微信授权手机号快捷登录，支持匿名通用头像名字/引用微信头像名字

暂不支持更换非本微信关联的手机号登录

● 支付方式：当前仅限拉起微信支付

● 安全要求：兑换码生成须使用加密组合防止被破解

● 兼容性：支持平台及版本（iOS 12+/Android 8+/微信基础库2.32+）

# 5.前端功能需求详情

### 5.1 首页

P2.2 - 购买确认页

• 展示内容：规格参数价格、数量、地址编辑（可支持调用微信地址）等等。

• 操作：底部悬浮“立即购买”按钮。

• 成功支付流程：点击确认购买 -> 调起微信支付 -> 支付成功 -> 跳转支付结果页 -> 引导进入个人中心查看。

### 5.3 个人中心

![[P3-个人中心-1.png]]

P3个人中心

用户场景：用户管理自己的资产、查看记录、联系客服。

1.头部区域：

• 会员背景：V1版本只做一个通用背景图（后续版本可升级为不同年卡/月卡身份不同显示）

• 用户信息：显示微信头像、微信昵称 / 默认匿名头像,昵称

• 登录状态：未登录显示“点击登录”，已登录显示头像昵称及“退出登录”按钮。

功能列表：

2.购买订单

P4-购买记录列表展示所有购买记录

|   |   |   |   |   |   |
|---|---|---|---|---|---|
|订单id|名称|数量|购买日期|状态|操作|
|001|年卡|2|2020-01-01 15:00|已完成|查看详情|
|002|月卡|1|2020-01-01 15:00|未支付|前往支付|
|003|年卡|3|2020-01-01 15:00|已取消|再来一单|

3.兑换记录：

P5 - 兑换记录列表展示历史所有成功兑换记录,包括虚拟门票和实体商品

|   |   |   |   |   |   |
|---|---|---|---|---|---|
|兑换id|名称|兑换码（点击显示）|兑换日期|状态|操作|
|001|年卡+礼盒|***********|2020-01-01 15:00|已完成|查看|
|002|基地鲜竹笋礼盒|-|2020-01-01 15:00|已完成|查看|

4. 联系官方客服：

联系方式：跳转微信公众号客服/小程序内置客服会话。

需要配置欢迎语为通用几个问题（待定注册好小程序后Joey尝试配置）

5.  礼品兑换

个人中心点击礼品兑换区输入兑换码确认后跳转 -> P6/P7

P6兑换页-门票兑换 (仅虚拟)

入口：点击“兑换”

兑换方式：

输码兑换：输入框输入兑换码。

逻辑：验证码有效性 -> 验证成功 -> 存入“个人中心-兑换记录” -> 提示兑换成功。

P7 -兑换页-邮寄产品 (虚拟+实体)

展示内容：商品图、详情描述要求。

下单流程：点击兑换 -> 输入兑换码 -> 填写/选择收货地址 (调用微信地址库或手动输入) -> 支付结算 -> 生成发货订单 -> 存入“个人中心-兑换记录” -> 提示兑换成功。

# 6.  详细状态逻辑（开发看）

### 6.1年卡/月卡购买订单状态机

|   |   |   |   |
|---|---|---|---|
|状态名称|触发条件|系统逻辑|异常处理|
|待支付|用户点击“立即购买|1. 创建订单记录。<br><br>2. 锁定该用户购买资格（防止并发下重复买两张）|开启15分钟倒计时。 \| 若用户此时杀掉进程，订单保留，倒计时结束后自动取消。|
|已取消|1. 倒计时结束。<br><br>2. 用户主动取消。|1. 释放购买资格锁。<br><br>2. 标记订单关闭。||
|已支付|微信支付回调 Success|1. 更新订单状态为“已支付”。<br><br>2.  核心动作： 在“用户会员卡表”中插入一条新记录（见下文权益状态）。<br><br>3. 发送订阅消息：“您的年卡已激活”。|掉单处理：若微信扣款成功但后台未更新，需提供“手动查询/补单”接口。|
|已退款|用户联系客服后台操作退款|1. 调用微信退款API。<br><br>2. 核心动作： 联动的会员卡状态必须同步变更为“已作废”。|退款前提必须是卡片“未使用”且“未过期”?<br><br>待业务确认是否可退,怎么退?|

商城礼品里涉及熊猫基地年卡兑换码，一但支持退款操作会涉及兑换码泄漏，不建议支持退款，仅限人工联系客服

### 6.2兑换码兑换异常态

|   |   |
|---|---|
|异常|提示文案|
|输入为空|“请输入兑换码”|
|格式不正确|“兑换码格式错误，请检查后再试”|
|查无此码|“兑换码不存在，请确认来源”|
|已使用|“兑换码已被使用，如有疑问请联系客服”|
|已过期|“兑换码已过期，无法兑换”|
|并发导致抢用|“卡券码已被其他设备使用，请确认是否重复操作”|
|系统错误|“系统开小差了，请稍后重试”|

# 7. 运营支持数据需求

定期数据导出报表

为支持运营团队在无后台情况下的工作，开发必须实现以下报表的定期（或按需）导出功能。

2.1 财务营收报表 (按需导出)

• 数据源：

• 用途：财务与商务对账，核算营收.如：商城购买汇总

• 核心导出字段：?

2.2 待发货清单 (按需导出)

• 数据源：

• 用途：仓库打印订单、打包发货

• 筛选条件：shipping_status = '待发货' 且 tracking_number 为空。

• 核心导出字段：?

2.3 会员卡清单 (按需生成/导出)

• 数据源：

• 用途：客服查询用户权益、手动处理卡片作废/延期。

• 核心导出字段：?

2.4 兑换码状态报表 (按需生成/导出)

• 数据源：

• 用途：客服导入新码、检查渠道券码发放和使用情况。

• 核心导出字段：?

# 8. 项目排期与资源

● 里程碑计划：关键节点（需求冻结/提测/上线）与交付物